#!/usr/bin/env ruby
puts 'Welcome to tic-tac-toe!'

def display_board
  puts ' 1 | 2 | 3 '
  puts '---+---+---'
  puts ' 4 | 5 | 6 '
  puts '---+---+---'
  puts ' 7 | 8 | 9 '
  puts "\n"
end

# rubocop:disable Metrics/MethodLength
# rubocop:disable Metrics/PerceivedComplexity
# rubocop:disable Metrics/BlockNesting
def ask_for_position(hash_list, player)
  x = false
  until x == true
    puts display_board
    print "Player '#{player}' please choose a position (from 1 to 9): "
    position = gets.chomp.to_i

    if position.is_a? Integer
      if position.positive? && position < 10
        if hash_list.fetch(position) == false
          x = true
          hash_list[position] = true
        else
          puts 'The position is taked, choose another position'
        end
      else
        puts 'Wrong position, choose a position between 1 to 9'
      end
    else
      puts 'Wrong position, choose a position between 1 to 9'
    end
  end
  hash_list
end
# rubocop:enable Metrics/MethodLength
# rubocop:enable Metrics/PerceivedComplexity
# rubocop:enable Metrics/BlockNesting

def winner?
  prng = Random.new
  prng.rand(10).even?
end

def draw?
  prng = Random.new
  prng.rand(10).even?
end

list_of_players = {}

print 'Please enter a name for player 1 (X): '
player1 = gets.chomp
list_of_players [:player1] = 'X'

print 'Please enter a name for player 2 (O): '
player2 = gets.chomp
list_of_players [:player2] = 'O'

list_of_positions = {}
1.upto(9) do |x|
  list_of_positions[x] = false
end

ready = false
until ready
  print "#{player1} and #{player2} are you ready? (Y/N): "
  str_ready = gets.chomp
  ready = str_ready.upcase == 'Y'
end

r = 1
while r <= 9
  current_player = r.even? ? player1 : player2
  list_of_positions = ask_for_position(list_of_positions, current_player)
  if r > 1
    var_winner = winner?
    var_draw = draw? if var_winner == false
    break if var_winner == true
    break if var_draw == true
  end
  r += 1
end

puts list_of_positions

puts "The winner is #{current_player}!!" if var_winner == true
puts 'It is a draw!' if var_draw == true

print 'Do you want to continue? (Y/N): '

puts 'bye amigo!!!'
